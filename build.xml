<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="plugin">
    <property name="source.folder" value="src/"/>
    <property name="build.folder" value="bin/"/>
    <property name="lib.folder" value="lib/"/>

    <property name="plugin.name" value="iRegulon"/>
    <property name="plugin.version" value="0.11"/>
    <property name="plugin.filename" value="iRegulon-${plugin.version}.jar"/>
    <property name="plugin.main" value="iRegulonInput.IRegulonPlugin"/>

    <!-- =================================================================== -->
    <!-- Clean up                                                            -->
    <!-- =================================================================== -->
    <target name="clean">
        <delete dir="${build.folder}"/>
    </target>

    <!-- =================================================================== -->
    <!-- Compiles the project                                                -->
    <!-- =================================================================== -->
    <path id="project.class.path">
        <pathelement path="${lib.folder}/xstream-1.4.3-bin.jar"/>
        <pathelement path="${lib.folder}/cytoscape-2.8.2-bin.jar"/>
    </path>

    <target name="compile" depends="clean">
        <mkdir dir="${build.folder}"/>
        <javac destdir="${build.folder}">
            <classpath refid="project.class.path"/>
            <src path="${source.folder}"/>
        </javac>
    </target>

    <!-- =================================================================== -->
    <!-- Copy the help-related files                                         -->
    <!-- =================================================================== -->
    <target name="help">
        <mkdir dir="${build.folder}/help"/>
        <copy todir="${build.folder}/help">
            <fileset dir="${basedir}/help" />
        </copy>
    </target>


    <!-- =================================================================== -->
    <!-- Copy the resources                                                  -->
    <!-- =================================================================== -->
    <target name="copy_resources" depends="compile">
        <copy todir="${build.folder}">
            <fileset dir="${source.folder}"
                     includes="**/*.props,**/*.properties,**/*.txt,**/*.png,**/*.jpg,**/*.xml,**/*.html,**/*.hs" />
        </copy>
    </target>

    <!-- =================================================================== -->
    <!-- Creates the plugin jar file                                         -->
    <!-- =================================================================== -->
    <target name="jar" depends="copy_resources,help">
        <jar destfile="${build.folder}/${plugin.filename}">
            <manifest>
                <attribute name="Cytoscape-Plugin" value="${plugin.main}" />
            </manifest>
         <fileset dir="${build.folder}" />
        </jar>
    </target>

    <target name="plugin" depends="copy_resources,help">
        <taskdef name="jarjar" classname="com.tonicsystems.jarjar.JarJarTask" classpath="${lib.folder}/jarjar-1.4-bin.jar"/>
        <jarjar jarfile="${build.folder}/${plugin.filename}">
            <manifest>
                <attribute name="Cytoscape-Plugin" value="${plugin.main}" />
            </manifest>
            <fileset dir="${build.folder}" />
            <zipfileset src="${lib.folder}/xstream-1.4.3-bin.jar"/>
            <zipfileset src="${lib.folder}/kxml2-2.3.0-bin.jar"/>
        </jarjar>
    </target>
</project>
